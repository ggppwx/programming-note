<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Effective python - My Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Effective python";
    var mkdocs_page_input_path = "booknotes/effective-python.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> My Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Book Note</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Effective python</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#effective-python">Effective python</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#pythonic-thinking">Pythonic thinking</a></li>
        
            <li><a class="toctree-l4" href="#functions">Functions</a></li>
        
            <li><a class="toctree-l4" href="#class">Class</a></li>
        
            <li><a class="toctree-l4" href="#concurrency">Concurrency</a></li>
        
            <li><a class="toctree-l4" href="#built-in-modules">built-in modules</a></li>
        
            <li><a class="toctree-l4" href="#collaboration">collaboration</a></li>
        
            <li><a class="toctree-l4" href="#production">production</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../cleancode/">Cleancode</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">My Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Book Note &raquo;</li>
        
      
    
    <li>Effective python</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="effective-python">Effective python<a class="headerlink" href="#effective-python" title="Permanent link">&para;</a></h1>
<h2 id="pythonic-thinking">Pythonic thinking<a class="headerlink" href="#pythonic-thinking" title="Permanent link">&para;</a></h2>
<h3 id="pep-8-style">PEP 8 style<a class="headerlink" href="#pep-8-style" title="Permanent link">&para;</a></h3>
<p><a href="https://pep8.org/">PEP 8 style</a></p>
<h3 id="helper-function">helper function<a class="headerlink" href="#helper-function" title="Permanent link">&para;</a></h3>
<h3 id="bytes-str-and-unicode">bytes, str and unicode<a class="headerlink" href="#bytes-str-and-unicode" title="Permanent link">&para;</a></h3>
<h3 id="how-to-slice">how to slice<a class="headerlink" href="#how-to-slice" title="Permanent link">&para;</a></h3>
<h3 id="dont-use-stride-with-startend">don&rsquo;t use stride with start/end<a class="headerlink" href="#dont-use-stride-with-startend" title="Permanent link">&para;</a></h3>
<h3 id="list-comprehensions">list comprehensions<a class="headerlink" href="#list-comprehensions" title="Permanent link">&para;</a></h3>
<h3 id="use-generator-to-replace-big-list-comprehension">use generator to replace big list comprehension<a class="headerlink" href="#use-generator-to-replace-big-list-comprehension" title="Permanent link">&para;</a></h3>
<h3 id="use-try-except-else-finally">use <em>try .. except &#x2026;. else &#x2026; finally</em><a class="headerlink" href="#use-try-except-else-finally" title="Permanent link">&para;</a></h3>
<h3 id="use-enumerate-instead-of-range">use <em>enumerate</em> instead of <em>range</em><a class="headerlink" href="#use-enumerate-instead-of-range" title="Permanent link">&para;</a></h3>
<h3 id="use-zip-to-do-parallel-iteration">use zip to do parallel iteration<a class="headerlink" href="#use-zip-to-do-parallel-iteration" title="Permanent link">&para;</a></h3>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<h3 id="dont-return-none-throw-exception">don&rsquo;t return <em>None</em>, throw exception<a class="headerlink" href="#dont-return-none-throw-exception" title="Permanent link">&para;</a></h3>
<h3 id="scope-in-closure">scope in closure<a class="headerlink" href="#scope-in-closure" title="Permanent link">&para;</a></h3>
<h3 id="use-generator-to-replace-list-from-function-return">use generator to replace <em>list</em> from function return<a class="headerlink" href="#use-generator-to-replace-list-from-function-return" title="Permanent link">&para;</a></h3>
<h3 id="be-defensive-when-iterating-over-arguents">Be defensive when iterating over arguents<a class="headerlink" href="#be-defensive-when-iterating-over-arguents" title="Permanent link">&para;</a></h3>
<p>Define a class which includes <code>__iter__</code>, pass the object to function </p>
<h3 id="variable-positional-arguents">Variable positional arguents<a class="headerlink" href="#variable-positional-arguents" title="Permanent link">&para;</a></h3>
<pre><code class="ptyhon">def log(message, *values):
      pass

    favorites = [7, 33, 99]
    log('Favorite colors', *favorites)
</code></pre>

<h3 id="provide-optional-behavior-with-keyword-arguments">provide optional behavior with keyword arguments<a class="headerlink" href="#provide-optional-behavior-with-keyword-arguments" title="Permanent link">&para;</a></h3>
<p>the sequence should be normal, positional, optional arguements </p>
<h3 id="use-none-and-docstring-to-sepecify-dynamic-default-argumetns">Use NONE and docstring to sepecify dynamic default argumetns<a class="headerlink" href="#use-none-and-docstring-to-sepecify-dynamic-default-argumetns" title="Permanent link">&para;</a></h3>
<pre><code class="python">    def decode(data, default=None):    
      &quot;&quot;&quot;Load JSON data from a string.
          Args:    
              data: JSON data to decode.
              default: Value to return if decoding fails.
                  Defaults to an empty dictionary.
          &quot;&quot;&quot;
          if default is None:
              default = {}     
</code></pre>

<h3 id="enforce-clarity-with-keyword-only-arguments">Enforce clarity with keyword-only arguments<a class="headerlink" href="#enforce-clarity-with-keyword-only-arguments" title="Permanent link">&para;</a></h3>
<p>Add <code>*</code> before keyword arguments, then it becomes keyword-only </p>
<pre><code class="python">    def safe_division_c(number, divisor, *,
                        ignore_overflow=False,
                        ignore_zero_division=False):
</code></pre>

<h2 id="class">Class<a class="headerlink" href="#class" title="Permanent link">&para;</a></h2>
<h3 id="prefer-helper-clsses-over-dictionary-and-tuples">Prefer helper clsses over dictionary and tuples<a class="headerlink" href="#prefer-helper-clsses-over-dictionary-and-tuples" title="Permanent link">&para;</a></h3>
<p>Avoid doing dictionary nesting more than one level 
Use <code>namedtuple</code> type </p>
<pre><code class="python">    import collections
    Grade = collections.namedtuple('Grade', ('score', 'weight'))
</code></pre>

<h3 id="accept-functions-instead-of-classes">Accept functions instead of classes<a class="headerlink" href="#accept-functions-instead-of-classes" title="Permanent link">&para;</a></h3>
<p>Use <code>lambda</code> and closure 
Function is first class object </p>
<pre><code class="python">    class CountMissing(object):
      def __init__(self):
        self.added = 0

     def __call__(self): # function
       self.added += 1
       return 0 

    counter = CountMissing()  # counter is a function 
    result = defaultdict(couter, current) 
</code></pre>

<h3 id="use-classmethod-to-construct-objects-generically">Use <code>@classmethod</code> to construct objects generically<a class="headerlink" href="#use-classmethod-to-construct-objects-generically" title="Permanent link">&para;</a></h3>
<p>Map reduce example. 
Add the creation funtion to the base class level </p>
<pre><code class="python">    class InputData(object):
      def read(self):
        raise NotImplementedError       
      @classmethod
      def generate_inputs(cls, config):
        raise NotImplementedError


    class Worker(object):
      def map(self):
        raise NotImplementedError

      def reduce(self, other)
        raise NotImplementedError

      @classmethod
      def create_workers(cls, input_class, config):
        workers = []
        for input_data in input_class.generate_inputs(config):
          workers.append(cls(input_data))  #cls =&gt; the sub-class itself 

      # LineCountWorker, PathInputData are sub-classes 
      workers = LineCountWorker.create_workers(PathInputData, config)
</code></pre>

<h3 id="initialize-parent-classes-with-super">Initialize parent classes with super<a class="headerlink" href="#initialize-parent-classes-with-super" title="Permanent link">&para;</a></h3>
<p>Avoid the subclass override the previous subclass, <code>super()</code> class only called once </p>
<pre><code class="python">    class Goodway(TimeFive, PlusTwo):
      def __init__(self, value):
        super(Goodway, self).__init__(value)
        # super().__init__(value) in python 3 

    ret = Goodway(5) # order is defined in MRO 
</code></pre>

<h3 id="use-multiple-inheritance-only-for-mix-in-utility-class">Use Multiple Inheritance only for mix-in utility class<a class="headerlink" href="#use-multiple-inheritance-only-for-mix-in-utility-class" title="Permanent link">&para;</a></h3>
<h2 id="concurrency">Concurrency<a class="headerlink" href="#concurrency" title="Permanent link">&para;</a></h2>
<h3 id="use-subprocess-to-manage-child-processes">Use <code>subprocess</code> to manage child processes<a class="headerlink" href="#use-subprocess-to-manage-child-processes" title="Permanent link">&para;</a></h3>
<ul>
<li>this makes python a good glue</li>
<li>communicate() to run subproceses, that could utilize the CPU </li>
<li>in python3, we could add timeout</li>
</ul>
<h3 id="use-threads-for-blocking-io-avoid-for-parallelsim">Use threads for blocking I/O. avoid for parallelsim<a class="headerlink" href="#use-threads-for-blocking-io-avoid-for-parallelsim" title="Permanent link">&para;</a></h3>
<ul>
<li>GIL, threading may causes program running longer !</li>
<li>but if the call is IO bound, for example, system call, threading will help </li>
</ul>
<pre><code class="python">class MyThread(Thread):
  def run(self):
    pass


t = MyThread()
t.start() # run threads
t.join() # wait threads 
</code></pre>

<h3 id="use-lock-to-prevent-data-race">Use <code>lock</code> to prevent data race<a class="headerlink" href="#use-lock-to-prevent-data-race" title="Permanent link">&para;</a></h3>
<h3 id="use-queue-to-coordinate-work-between-threads">Use <code>Queue</code> to COORDINATE WORK BETWEEN THREADS<a class="headerlink" href="#use-queue-to-coordinate-work-between-threads" title="Permanent link">&para;</a></h3>
<p>The <code>Queue</code> class from <code>queue</code> module provides thread-safe approache. 
Need to be aware of problem building pipline. busy waiting, stopping workers, memory explosion. </p>
<pre><code class="python">in_queue = Queue()
def consumer():
    work = in_queue.get()
    # doing the work
    in_queue.task_done() # eliminate the need for polling done_queue 

Thread(target=consumer).start()

in_queue.put(object())
in_queue.join() # waiting in_queue to finish 
</code></pre>

<h3 id="consider-coroutines-to-run-many-functions-concurrently">CONSIDER COROUTINES TO RUN MANY FUNCTIONS CONCURRENTLY<a class="headerlink" href="#consider-coroutines-to-run-many-functions-concurrently" title="Permanent link">&para;</a></h3>
<ul>
<li>Threads require a lot of memory </li>
<li>need special tools like <code>lock</code></li>
<li>costly to start   </li>
</ul>
<pre><code class="python">def minimize():
  current = yield
  while True:
    value = yield current # return current 
    current = min(current, value)

it = minimize()
next(it)
it.send(10)
it.send(15)
</code></pre>

<h3 id="consider-concurrentfutures-for-true-parallelsim">consider <code>concurrent.futures</code> for true parallelsim<a class="headerlink" href="#consider-concurrentfutures-for-true-parallelsim" title="Permanent link">&para;</a></h3>
<p>Because GIL, you may hit performance wall 
we could use <code>multiprocessing</code> module</p>
<pre><code class="python">def gcd(pair):
  # some operations
  pass 

pool = ProcessPoolExecutor(max_workers=2)
pool.map(gcd, numbers) # gcd(number_pair)

</code></pre>

<h2 id="built-in-modules">built-in modules<a class="headerlink" href="#built-in-modules" title="Permanent link">&para;</a></h2>
<h3 id="define-function-decorators-with-functoolswraps">define function decorators with <code>functools.wraps</code><a class="headerlink" href="#define-function-decorators-with-functoolswraps" title="Permanent link">&para;</a></h3>
<p>Decorators: run addional code before/after any calls  <br />
Use <code>wraps</code> to make the function name unchanged   </p>
<pre><code class="python">    def trace(func):
       @wraps(func)
       def wrapper(*args, **kwargs):
          pass
       return wrapper
</code></pre>

<h3 id="consider-contextlib-and-with-statement-for-reusable-try-behavior">consider <code>contextlib</code> and <code>with</code> statement for reusable try behavior<a class="headerlink" href="#consider-contextlib-and-with-statement-for-reusable-try-behavior" title="Permanent link">&para;</a></h3>
<ul>
<li>with == try/finally block</li>
<li>enalbe your objects to <code>with</code> using <code>contextlib</code></li>
<li>simpler than adding <code>__enter__</code> <code>__exit__</code></li>
</ul>
<pre><code class="python">    @contextmanager
    def debug_logging(level):
       logger.setLevel(level)
       try:
          yield  # which with block execute 
          # yield logger #if we wanna use as 
       finally:
          pass
</code></pre>

<h3 id="make-pickle-reliable-with-copyreg">make <code>pickle</code> reliable with <code>copyreg</code><a class="headerlink" href="#make-pickle-reliable-with-copyreg" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>pickle.dump and pickle.load useful for saving game</p>
<p>copyreg.pickle(GameState, pickle_game_state)</p>
</li>
<li>
<p>stable import path</p>
</li>
</ul>
<h3 id="use-datetime-instead-of-time">Use <code>datetime</code> instead of <code>TIME</code><a class="headerlink" href="#use-datetime-instead-of-time" title="Permanent link">&para;</a></h3>
<pre><code class="python">eastern = pytz.timezone('US/Eastern')
nyc_dt = eastern.localize(nyc_dt_native)
utc_dt = pytz.utc.normalize(nyc_dt.astimezone(pytz.utc))
</code></pre>

<h3 id="use-built-in-algorithm-and-data-structure">Use built-in algorithm and data structure<a class="headerlink" href="#use-built-in-algorithm-and-data-structure" title="Permanent link">&para;</a></h3>
<ul>
<li><code>deque()</code></li>
<li><code>OrderedDict</code></li>
<li><code>defaultdict</code></li>
<li><code>heapq</code>, <code>heappush</code>, <code>heappop</code></li>
<li>=bisect<sub>left</sub>(x, 99999) binary serach</li>
<li><code>itertools</code></li>
</ul>
<h2 id="collaboration">collaboration<a class="headerlink" href="#collaboration" title="Permanent link">&para;</a></h2>
<h3 id="write-docstrings-for-class-function-module">Write docstrings for class, function, module<a class="headerlink" href="#write-docstrings-for-class-function-module" title="Permanent link">&para;</a></h3>
<pre><code class="python">&quot;&quot;&quot; Libarary for XXXX
Module level docs 

&quot;&quot;&quot;
class Player(ojbect):
  &quot;&quot;&quot; class level docs 
  Public attributes:
  - a: what a is ...
  - b: what b is ... 
  &quot;&quot;&quot;

  def find_args():
      &quot;&quot;&quot; Function description
      Args:
          a: what a is 
      Returns:
          what the return is       
      &quot;&quot;&quot;
</code></pre>

<h3 id="use-packages-to-organize-modules">Use packages to organize modules<a class="headerlink" href="#use-packages-to-organize-modules" title="Permanent link">&para;</a></h3>
<p>Package structure</p>
<pre><code>main.py
mypackage/__init__.py
mypackage/models.py
mypackage/utils.py

</code></pre>

<p>Exposese some funtions in API</p>
<pre><code class="python"># modules.py
__all__ = ['function']
def fucntion(a):
    pass
</code></pre>

<h3 id="define-a-root-exception-to-insulate-callers-from-api">Define a root <code>exception</code> to insulate callers from API<a class="headerlink" href="#define-a-root-exception-to-insulate-callers-from-api" title="Permanent link">&para;</a></h3>
<pre><code class="python">class Error(Exception):
    &quot;&quot;&quot;Base class for all exceptions raised by this module&quot;&quot;&quot;

class SomeRealError(Error):
    pass


</code></pre>

<h3 id="use-virtual-environment">Use virtual environment<a class="headerlink" href="#use-virtual-environment" title="Permanent link">&para;</a></h3>
<p>Use <code>pip3</code>, Use virtual environment</p>
<pre><code>pyvenv /dir/to/project
cd /dir/to/project
source /bin/activate

pip3 install -r requiremets.txt

deactivate
</code></pre>

<h2 id="production">production<a class="headerlink" href="#production" title="Permanent link">&para;</a></h2>
<h3 id="consider-module-scoped-code-to-configure-deployment-environment">Consider module-scoped code to configure deployment environment<a class="headerlink" href="#consider-module-scoped-code-to-configure-deployment-environment" title="Permanent link">&para;</a></h3>
<pre><code class="python"># dev_main.py
TESTING = True
</code></pre>

<pre><code class="python"># prod_main.py
TESTING = False
</code></pre>

<pre><code class="python">import __main__
if __main__.TESTING:
   # use testing settingss 

</code></pre>

<h3 id="use-repr-strings-for-debug-output">Use <code>repr</code> strings for debug output<a class="headerlink" href="#use-repr-strings-for-debug-output" title="Permanent link">&para;</a></h3>
<p>Always use <code>repr</code> version of the object when debug print </p>
<pre><code class="python">pirnt(repr(a))
print(obj.__dict__)


class Someclass(object):
    def __repr__(self):
        return 'output you want '        
</code></pre>

<h3 id="test-everything-with-unittest">Test everything with unittest<a class="headerlink" href="#test-everything-with-unittest" title="Permanent link">&para;</a></h3>
<ul>
<li>the only way to have confidence in program is to write tests </li>
<li>unit-test for isolated functionality, integration tests for modules that interact </li>
</ul>
<h3 id="use-pdb-to-debug">Use <code>pdb</code> to debug<a class="headerlink" href="#use-pdb-to-debug" title="Permanent link">&para;</a></h3>
<p>Add pdb to the code </p>
<pre><code class="python">def complex_func():
   import pdb; pdb.set_trace() # this is like set break point 
</code></pre>

<h3 id="profile-before-optimizing">profile before optimizing<a class="headerlink" href="#profile-before-optimizing" title="Permanent link">&para;</a></h3>
<p>Run <code>cProfile</code> module </p>
<pre><code class="python">profiler = Profile()
profiler.runcall(test)


stats = Stats(profiler)
stats.print_stats()

stats.print_callers()

</code></pre>

<h3 id="use-tracemalloc-to-understand-memory-usage">Use <code>tracemalloc</code> to understand memory usage<a class="headerlink" href="#use-tracemalloc-to-understand-memory-usage" title="Permanent link">&para;</a></h3>
<pre><code class="python">time1 = tracemalloc.take_snapshot()
.....
time2 = tracemalloc.take_snapshot()
stats = time2.compare_to(time1, 'lineno')

</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cleancode/" class="btn btn-neutral float-right" title="Cleancode">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../.." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../.." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../cleancode/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
